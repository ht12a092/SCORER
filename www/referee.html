<!DOCTYPE html>
<html lang="ja">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta http-equiv="Content-Style-Type" content="text/css">

	<title>RoboCup Jr. SCORER</title>

    <link type="text/css" rel="stylesheet" href="./css/jquery-ui.css">
	<link type="text/css" rel="stylesheet" href="./css/skyblue.min.css">
	<link type="text/css" rel="stylesheet" href="./css/common.css">

    <script type="text/javascript" src="./js/jquery-2.1.3.min.js"></script>
    <script type="text/javascript" src="./js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="./js/socket.io-1.3.5.js"></script>
    <script type="text/javascript" src="./js/common.js"></script>

</head>

<body>

<script type="text/javascript">
// ゲーム時間の記録変数
var gameCountTime=0;

// インターバル変数
var timeInterval;

// 終了状態の記録変数
var endStatus;


/**
 * 文字数の整形を行う
 */
var setCarry00 = function(c) {
	if(c < 10) {
		return '0'+c;
	} else {
		return c;
	}
};


/**
 * 経過時間をフォーマットする
 */
var getHmsTime = function(sec) {

	var h = parseInt(sec/3600);
	var m = parseInt((sec-=(h*3600))/60);
	var s = parseInt(sec-=(m*60));

	return setCarry00(h)+':'+setCarry00(m)+':'+setCarry00(s);
};


/**
 * ゲームの経過時刻を描画する
 */
var viewNowSec = function() {
    $('#playTime', parent.document).text(getHmsTime(gameCountTime));

    // ToDo: 複数での審判に備えてチーム名を付随させる。
    competIo.emit("time", {time: getHmsTime(gameCountTime)});

    gameCountTime++;
};


$(document).ready(function() {

    clearInterval(timeInterval);

    // ゲーム時間のカウント開始
    timeInterval = setInterval("viewNowSec()",1000);

    // Buttonの各イベント処理
    $('.btn').on('click', function() {
        
        switch($(this).data('btn')) {
            case 'retireButton':    // リタイアボタン
            case 'exitButton':      // 終了ボタン
                endStatus = $(this).data('btn');
                $('#exitPanel').dialog('open');
            break;

            // ゲーム終了確定
            case 'exitConfirmed':
            
                // ゲーム時間の計測を停止
                clearInterval(timeInterval);
                
                $('#exitPanel').dialog('close'); // 確認パネルを閉じる
                
//                {endStatus: endStatus, time: time}
                
                // サーバとの通信処理
                // スコアのやりとり

	chatSocket.emit("endGame", scoaArray);//ファイルへ書き出ししてる。
	guideSocket.emit("info", {'大会名':scoaArray['大会名'], 'チーム名':scoaArray['チーム名'], 'field':scoaArray['field'],'合計':scoaArray['合計']});

	guideSocket.emit("exit");
    
    // スコア確認ページ（サインとか）に遷移

            break;
        }

    });


});

</script>

<table class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>項目</th>
            <th>採点</th>
            <th>点数</th>
        </tr>
    </thead>
    <tbody id="scoaTable">
    </tbody>
</table>

<!-- コントローラダイアログ -->
<div id="control" title="判定" class="dialog">
    <a onclick="control('success');" class="btn btn-success">成功</a>
    <a onclick="control('error');" class="btn btn-error">失敗</a>
    <a onclick="control('light');" class="btn btn-light">クリア</a>
</div>

<!-- コントローラダイアログ -->
<div id="exitPanel" title="確認" class="dialog">
    <p>採点を終了しますか?</p>
    <a data-btn="exitConfirmed" class="btn btn-success">Yes</a>
    <a onclick="$('#exitPanel').dialog('close');" class="btn">No</a>
</div>

</body>
</html>