<script type="text/javascript" src="./js/jquery-2.1.3.min.js"></script>
<script type="text/javascript" src="./js/socket.io-1.3.5.js"></script>

<table>
    <tr>
        <td>
            <!-- ToDo: この辺のCSSを別ファイルに分けたい -->
            <div id="infobox" style="border-style: dashed;border-width: 1px;width: 800px;border-color: #000;font-size: 28px;"></div>
            <div id="time" style="border-style: dashed;border-width: 1px;width: 800px;border-color: #000;font-size: 28px;"></div>
            <video id="video" autoplay width="800" height="600"></video><br />
            <canvas id="canvas" width="800" height="600" style="display: none;"></canvas>
        </td>
        <td>
            <div style="border-style: dashed;border-width: 1px;width: 100%;height: 700px;border-color: #000;font-size: 28px;overflow-y: scroll;">
                <table id="msgbox" style="border-style: dashed;border-width: 1px;font-size: 28px;"></table>
            </div>
        </td>
    </tr>
</table>

<button id="stop">stop</button><br />

<!--  -->

<script type="text/javascript">

// ゲーム時間の記録変数
var gameTime = "";
var competIo	= io.connect("http://"+location.host.split(":")[0]+":3002");		// 競技情報（時間など）

var video = document.getElementById('video');
//var canvas = document.getElementById('canvas');
//var ctx = canvas.getContext('2d');
var localMediaStream = null;

var chatSocket = io.connect("http://"+location.host.split(":")[0]+":8082");

/* ---- */

var onFailSoHard = function(e) {
    console.log('エラー!', e);
};
 
window.URL = window.URL || window.webkitURL;
navigator.getUserMedia  = navigator.getUserMedia || navigator.webkitGetUserMedia ||
                          navigator.mozGetUserMedia || navigator.msGetUserMedia;
navigator.getUserMedia({video: true}, function(stream) {
  video.src = window.URL.createObjectURL(stream);
  localMediaStream = stream;
}, onFailSoHard);

$("#stop").click(function() {
    localMediaStream.stop();
});

//setInterval(function() {
	//ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
	//サーバに送信
	//chatSocket.emit("video", canvas.toDataURL("image/webp"));
//}, 1000);

chatSocket.on("guide", function (data) {
	console.log(data);

    $('#msgbox').prepend($('<tr>').html("<td style='vertical-align: top !important'>"+gameTime+"</td><td>"+data.msg+"</td>").css('color',data.color));
});

chatSocket.on("info", function (data) {
	console.log(data);
    document.getElementById("infobox").innerHTML=data['大会名']+"<br>"+data['チーム名']+" 現在の得点"+data['合計']+"点";
});

competIo.on("time", function (data) {
    document.getElementById("time").innerHTML="競技時間 "+data.time;
    gameTime=data.time;
});


chatSocket.on("clear", function (data) {
   $('#msgbox tr').remove();
});

</script>